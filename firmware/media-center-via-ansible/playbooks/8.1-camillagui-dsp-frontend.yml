- name: install CamillaDSP FE
  hosts: raspberry
  become: true
  
  tasks:

  - name: create camillagui folder
    ansible.builtin.file:
      path: /home/camilla/camillagui
      state: directory
      owner: camilla
      group: camilla

  - name: pull camilla gui
    ansible.builtin.unarchive:
      src: https://github.com/HEnquist/camillagui-backend/releases/download/v2.1.1/camillagui.zip
      dest: /home/camilla/camillagui
      remote_src: yes

  - name: camillagui folder permissions
    ansible.builtin.file:
      dest: /home/camilla/camillagui
      state: directory
      owner: camilla
      group: camilla
      recurse: true

  - name: install camilla gui service
    ansible.builtin.copy:
      dest: "/etc/systemd/system/camillagui.service"
      content: |
        [Unit]
        Description=CamillaDSP Backend and GUI
        After=default.target

        [Service]
        Type=idle
        User=camilla
        WorkingDirectory=~
        ExecStart=python3 camillagui/main.py

        [Install]
        WantedBy=default.target

  - name: start camilla gui service
    ansible.builtin.service:
      name: camillagui
      state: restarted
      enabled: true
      daemon_reload: yes